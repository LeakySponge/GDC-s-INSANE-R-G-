extends Node

@export var starting_pitch := 1.0
@export var max_pitch := 2.0
@export var pitch_ramp := 0.1
@export var ramp_max_time := 1.0
@export var timed := true

var _current_pitch: = 1.0

@onready var detachable_audio_player: = $DetachableAudioPlayer
@onready var timer: = $Timer



func _ready() -> void :
	timer.connect("timeout", Callable(self, "_on_timer_timeout"))

	timer.wait_time = ramp_max_time
	_current_pitch = starting_pitch



func play_ramped() -> void :
	if timed:
		timer.start()
	detachable_audio_player.random_audio_player.min_pitch = _current_pitch
	detachable_audio_player.random_audio_player.max_pitch = _current_pitch
	detachable_audio_player.play_detached()
	_current_pitch = min(_current_pitch + pitch_ramp, max_pitch)


func reset_ramp() -> void :
	_current_pitch = starting_pitch



func _on_timer_timeout() -> void :
	reset_ramp()
