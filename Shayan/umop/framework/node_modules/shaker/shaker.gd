extends Node2D

@export (NodePath)onready var target = (get_node(target) as Node2D) if target else get_parent()
@export var noise_rate := 750.0
@export var shake_dwindle := 15.0

var _noise: = FastNoiseLite.new()
var _noise_sample: = 0.0
var _shake_amount: = 0.0
var _shake_offset: = Vector2.ZERO



func _ready() -> void :
	_noise.seed = randi()


func _process(delta: float) -> void :
	var prev_shake = _shake_offset

	if _shake_amount >= 1:
		_shake_amount = lerp(0, _shake_amount, pow(2, - shake_dwindle * delta))
		_noise_sample += noise_rate * delta
		_shake_offset = Vector2(_noise.get_noise_2d(_noise_sample, 0) * pow(_shake_amount, 2), _noise.get_noise_2d(_noise_sample, 75) * pow(_shake_amount, 2))

	target.position = target.position - prev_shake + _shake_offset



func shake(amount: float) -> void :
	_shake_amount = amount
