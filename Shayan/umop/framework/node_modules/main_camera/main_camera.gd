extends Camera2D

@export var background_clear_color # (Color, RGB)
@export var noise_rate := 1000.0
@export var shake_dwindle := 20.0
@export var follow_speed := 20.0
@export var mouse_follow_distance := 32.0
@export var mouse_follow_threshold := 48.0

var _noise: = FastNoiseLite.new()
var _noise_sample: = 0.0
var _shake_amount: = 0.0
var _shake_offset: = Vector2.ZERO



func _ready() -> void :
	Game.camera = self
	RenderingServer.set_default_clear_color(background_clear_color)

	_noise.seed = randi()


func _process(delta: float) -> void :
	if _shake_amount >= 1:
		_shake_amount = lerp(0, _shake_amount, pow(2, - shake_dwindle * delta))
		_noise_sample += noise_rate * delta
		_shake_offset = Vector2(_noise.get_noise_2d(_noise_sample, 0) * pow(_shake_amount, 2), _noise.get_noise_2d(_noise_sample, 75) * pow(_shake_amount, 2))

	offset = _shake_offset



func shake(amount: float) -> void :
	if Settings.can_screen_shake:
		_shake_amount += amount
