extends Node2D

@export (NodePath)onready var target = (get_node(target) as Sprite2D) if target else get_parent()
@export var transition_duration := 1.0
@export var stay_duration := 1.0
@export var property_name := ""
@export var values := []
@export var autostart := true
@export var lap_count := 0

var _bobbing_positions: = []
var _is_staying: = false
var _swaps_left: = 0

@onready var tween: = $Tween



func _ready() -> void :
	tween.connect("tween_all_completed", Callable(self, "_on_tween_tween_all_completed"))

	_bobbing_positions.resize(2)
	_bobbing_positions[0] = values[0]
	_bobbing_positions[1] = values[1]

	_swaps_left = lap_count * 2

	if autostart:
		resume()



func start() -> void :
	tween.remove_all()

	_bobbing_positions.resize(2)
	_bobbing_positions[0] = values[0]
	_bobbing_positions[1] = values[1]

	_swaps_left = lap_count * 2

	resume()


func resume() -> void :
	tween.resume_all()


func stop() -> void :
	tween.stop_all()


func swap() -> void :
	tween.interpolate_property(target, property_name, _bobbing_positions[0], _bobbing_positions[1], transition_duration, Tween.TRANS_QUAD, Tween.EASE_IN_OUT)
	tween.start()
	_bobbing_positions.invert()



func _on_tween_tween_all_completed() -> void :
	if _swaps_left > 0 or lap_count == 0:
		_swaps_left -= 1
		swap()
